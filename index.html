<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPPT Training Plan Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Base styles are now for Light Mode */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9; /* slate-100 */
            color: #1e293b; /* slate-800 */
            background-image: none;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .glass-container {
            background-color: rgba(255, 255, 255, 0.8); /* white with opacity */
            border: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        .loader {
            position: relative;
            width: 50px;
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .loader::before, .loader::after {
            content: '';
            position: absolute;
            border-radius: 50%;
            animation: bubble 2.5s infinite ease-in-out;
            filter: blur(5px);
        }

        .loader::before {
            width: 100%;
            height: 100%;
            background-image: linear-gradient(45deg, #38bdf8, #818cf8);
        }

        .loader::after {
            width: 70%;
            height: 70%;
            background-image: linear-gradient(-45deg, #a78bfa, #c084fc);
            animation-delay: -0.6s;
        }

        @keyframes bubble {
            0%, 100% {
                transform: scale(0.7);
                opacity: 0.5;
            }
            50% {
                transform: scale(1);
                opacity: 0.8;
            }
        }
        
        /* Custom scrollbar for light mode */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #e2e8f0; }
        ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }

        /* Dark Mode Styles */
        body.dark-mode {
            background-color: #0f172a;
            color: #cbd5e1; /* slate-300 */
            background-image: radial-gradient(circle at top right, rgba(14, 165, 233, 0.2), transparent 40%),
                              radial-gradient(circle at bottom left, rgba(139, 92, 246, 0.2), transparent 50%);
            background-attachment: fixed;
        }
        .dark-mode .glass-container {
            background-color: rgba(30, 41, 59, 0.5); /* slate-800 with opacity */
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: none;
        }
        /* Text colors */
        .dark-mode .text-slate-500,
        .dark-mode .text-slate-600 { color: #94a3b8; } /* slate-400 */
        .dark-mode .text-slate-700 { color: #cbd5e1; } /* slate-300 */
        .dark-mode .text-slate-800 { color: #e2e8f0; } /* slate-200 */
        .dark-mode .text-slate-900 { color: #f1f5f9; } /* slate-100 */
        .dark-mode .text-sky-600 { color: #38bdf8; } /* sky-400 */
        .dark-mode .text-sky-800 { color: #7dd3fc; } /* sky-300 */
        .dark-mode .text-blue-600 { color: #60a5fa; } /* blue-400 */
        
        /* Backgrounds & Inputs */
        .dark-mode .bg-slate-50, 
        .dark-mode .bg-slate-100 { 
            background-color: rgba(51, 65, 85, 0.5); /* slate-700/50 */
        }
        .dark-mode input, .dark-mode select {
            background-color: rgba(30, 41, 59, 0.5);
            color: #cbd5e1;
        }
        .dark-mode .bg-sky-100 { background-color: rgba(14, 165, 233, 0.2); }
        .dark-mode .hover\:bg-sky-200:hover { background-color: rgba(14, 165, 233, 0.3); }
        .dark-mode .bg-indigo-50 { background-color: rgba(99, 102, 241, 0.1); }
        .dark-mode .bg-sky-50 { background-color: rgba(14, 165, 233, 0.1); }

        /* Borders */
        .dark-mode .border-slate-300 { border-color: #334155; } /* slate-700 */
        .dark-mode input, .dark-mode select {
            border-color: #475569; /* slate-600 */
        }
        .dark-mode .border-sky-200 { border-color: rgba(56, 189, 248, 0.3); }

        /* Prose */
        .dark-mode .prose { color: #94a3b8; }
        .dark-mode .prose-strong { color: #f1f5f9; }
        .dark-mode .prose-headings { color: #e2e8f0; }

        /* Result Spans & Badges */
        .dark-mode .bg-red-100 { background-color: rgba(239, 68, 68, 0.2); }
        .dark-mode .text-red-800 { color: #f87171; }
        .dark-mode .bg-yellow-100 { background-color: rgba(234, 179, 8, 0.2); }
        .dark-mode .text-yellow-800 { color: #facc15; }
        .dark-mode .bg-slate-200 { background-color: rgba(100, 116, 139, 0.2); }
        .dark-mode .bg-green-100 { background-color: rgba(34, 197, 94, 0.2); }
        .dark-mode .text-green-800 { color: #4ade80; }
        .dark-mode .bg-gray-200 { background-color: rgba(100, 116, 139, 0.2); }
        .dark-mode .text-gray-700 { color: #94a3b8; }

        /* Placeholders */
        .dark-mode input::placeholder { color: #64748b; }
        
        /* Icons & Buttons */
        .dark-mode .delete-attempt-btn { color: #64748b; }
        .dark-mode .delete-attempt-btn:hover { color: #ef4444; }

        /* Scrollbar */
        .dark-mode ::-webkit-scrollbar-track { background: #0f172a; }
        .dark-mode ::-webkit-scrollbar-thumb { background: #334155; }
        .dark-mode ::-webkit-scrollbar-thumb:hover { background: #475569; }

        /* Other fixes */
        .dark-mode h1.bg-clip-text { background-image: linear-gradient(to right, #38bdf8, #818cf8); }

        #theme-toggle {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 50;
        }
    </style>
</head>
<body class="text-slate-800">

    <div id="theme-toggle" class="cursor-pointer p-2 rounded-full transition-colors hover:bg-slate-500/20">
        <!-- Sun Icon -->
        <svg id="theme-toggle-light-icon" class="w-6 h-6 text-yellow-300 hidden" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.707.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM10 16a1 1 0 100 2 1 1 0 000-2zm-8-5a1 1 0 100 2h1a1 1 0 100-2H2zm8-7a1 1 0 00-1 1v1a1 1 0 102 0V3a1 1 0 00-1-1zM4.05 15.357a1 1 0 101.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zM2.93 4.343a1 1 0 011.414 0l.707.707a1 1 0 01-1.414 1.414l-.707-.707a1 1 0 010-1.414z"></path></svg>
        <!-- Moon Icon -->
        <svg id="theme-toggle-dark-icon" class="w-6 h-6 text-slate-400 hidden" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>
    </div>

    <div class="container mx-auto max-w-4xl p-4 sm:p-6 md:p-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold bg-gradient-to-r from-sky-500 to-violet-600 text-transparent bg-clip-text">IPPT Training Plan Generator</h1>
            <p class="mt-2 text-slate-500">Enter your details and past results to get a customized AI-powered training plan.</p>
        </header>

        <main class="glass-container p-6 sm:p-8 rounded-2xl shadow-2xl space-y-8">
            <!-- Section 1: Officer's Details -->
            <section id="officer-details">
                <div class="flex justify-between items-center mb-4 border-b border-slate-300 pb-2">
                    <h2 class="text-xl font-semibold text-slate-900">1. Officer's Details</h2>
                    <button id="clear-all-btn" class="text-sm text-sky-600 hover:underline">Clear All</button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="name" class="block text-sm font-medium text-slate-700">Name</label>
                        <input type="text" id="name" class="mt-1 block w-full rounded-md bg-slate-50 border-slate-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2.5" placeholder="e.g., John Doe">
                    </div>
                    <div>
                        <label for="age" class="block text-sm font-medium text-slate-700">Age</label>
                        <input type="number" id="age" class="mt-1 block w-full rounded-md bg-slate-50 border-slate-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2.5" placeholder="e.g., 25">
                        <p id="age-group-display" class="text-xs text-slate-500 mt-1">Age Group: --</p>
                    </div>
                    <div class="md:col-span-2">
                        <label for="gender" class="block text-sm font-medium text-slate-700">Gender</label>
                        <select id="gender" class="mt-1 block w-full rounded-md bg-slate-50 border-slate-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2.5">
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                        </select>
                    </div>
                    <div class="md:col-span-2">
                        <label for="work-cycle" class="block text-sm font-medium text-slate-700">Work Cycle</label>
                        <select id="work-cycle" class="mt-1 block w-full rounded-md bg-slate-50 border-slate-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2.5">
                            <option value="GRF Officer">GRF Officer</option>
                            <option value="Office Hours">Office Hours</option>
                        </select>
                    </div>
                    <div class="md:col-span-2">
                         <label for="target-goal" class="block text-sm font-medium text-slate-700">Target Goal</label>
                         <select id="target-goal" class="mt-1 block w-full rounded-md bg-slate-50 border-slate-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2.5">
                            <option value="" disabled selected>Select a target award</option>
                            <option value="Pass">Pass</option>
                            <option value="Silver">Silver</option>
                            <option value="Gold">Gold</option>
                        </select>
                    </div>
                    <div class="md:col-span-2">
                         <label for="medical-fitness" class="block text-sm font-medium text-slate-700">Medical Fitness Status</label>
                         <input type="text" id="medical-fitness" class="mt-1 block w-full rounded-md bg-slate-50 border-slate-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2.5" value="None">
                    </div>
                </div>
            </section>

            <!-- Section 2: IPPT Attempts -->
            <section id="ippt-attempts">
                <div class="flex justify-between items-center mb-4 border-b border-slate-300 pb-2">
                    <h2 class="text-xl font-semibold text-slate-900">2. IPPT Attempts</h2>
                </div>
                <div id="attempts-container" class="space-y-4">
                    <!-- Dynamic attempt rows will be injected here -->
                </div>
            
                <div class="mt-4">
                    <button id="add-attempt-btn" class="w-full flex items-center justify-center gap-2 bg-sky-100 hover:bg-sky-200 text-sky-800 font-semibold py-2 px-4 rounded-lg transition-colors duration-200 ease-in-out border border-sky-200">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                          <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
                        </svg>
                        <span id="add-attempt-btn-text">Add First Attempt</span>
                    </button>
                </div>
                 <div id="weakness-analysis-section" class="hidden mt-6 text-center">
                    <div class="flex flex-wrap justify-center gap-4">
                        <button id="analyze-weakness-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-all duration-200">
                            ✨ Analyze Weaknesses
                        </button>
                        <button id="export-excel-btn" class="bg-teal-600 hover:bg-teal-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-all duration-200 flex items-center gap-2">
                             <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                            </svg>
                            Export to Excel
                        </button>
                    </div>
                    <div id="weakness-output" class="mt-4 text-left p-4 bg-indigo-50 rounded-lg min-h-[50px]"></div>
                </div>
            </section>

            <!-- Section 3: Generate Plan -->
            <section id="generate-section" class="pt-4 text-center">
                 <div class="mb-6 text-left">
                    <label for="api-key" class="block text-sm font-medium text-slate-700">Google AI API Key</label>
                    <input type="password" id="api-key" class="mt-1 block w-full rounded-md bg-slate-50 border-slate-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2.5" placeholder="Enter your API key here">
                    <p class="mt-1 text-xs text-slate-500">You need a free key to generate the plan. Get yours from <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-blue-600 hover:underline">Google AI Studio</a>.</p>
                </div>
                <button id="generate-plan-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:shadow-lg transition-all duration-200 ease-in-out transform hover:-translate-y-0.5 w-full md:w-auto">
                    Generate Training Plan
                </button>
                <div id="generation-status" class="mt-4 min-h-[50px] flex justify-center items-center"></div>
            </section>
            
            <!-- Section 4: Output -->
            <section id="output-section" class="hidden">
                 <h2 class="text-xl font-semibold text-slate-900 mb-4 border-b border-slate-300 pb-2">Your Personalised Training Plan</h2>
                 <div id="plan-output" class="prose max-w-none prose-slate mt-4 p-4 bg-slate-50 rounded-lg text-slate-700 prose-strong:text-slate-900 prose-headings:text-slate-800">
                     <!-- AI generated plan will be displayed here -->
                 </div>
                 <div id="dietary-section" class="mt-6 text-center">
                     <button id="dietary-btn" class="bg-sky-600 hover:bg-sky-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-all duration-200">
                        ✨ Get Dietary Tips
                    </button>
                    <div id="dietary-output" class="mt-4 text-left p-4 bg-sky-50 rounded-lg min-h-[50px] hidden"></div>
                 </div>
            </section>
        </main>

        <footer class="text-center mt-8 text-sm text-slate-500">
            <p>IPPT Training Plan Generator &copy; 2024. For training guidance only.</p>
        </footer>
    </div>

    <script type="module" src="js/app.js"></script>
</body>
</html>